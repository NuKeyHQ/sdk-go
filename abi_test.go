package voltasdk

import (
	"fmt"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"math/big"
	"testing"
)

func TestExecuteBatchEncoding(t *testing.T) {
	calls := []Call{
		{
			Target: common.HexToAddress("0xEfD3B4676A3778c915f9D15b3f13429327a68207"),
			Value:  big.NewInt(1),
			Data:   []byte{},
		},
		{
			Target: common.HexToAddress("0xa0Cb889707d426A7A386870A03bc70d1b0697598"),
			Value:  big.NewInt(0),
			Data:   hexutil.MustDecode("0xa9059cbb0000000000000000000000007883fa22c69c479e6fb8ea22f6d32bc44ee8b255000000000000000000000000000000000000000000000000016345785d8a0000"),
		},
	}
	expected := "0x34fcd5be00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000efd3b4676a3778c915f9d15b3f13429327a68207000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0cb889707d426a7a386870a03bc70d1b0697598000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000044a9059cbb0000000000000000000000007883fa22c69c479e6fb8ea22f6d32bc44ee8b255000000000000000000000000000000000000000000000000016345785d8a000000000000000000000000000000000000000000000000000000000000"

	packed, err := accountABI.Pack("executeBatch", calls)
	if err != nil {
		t.Fatal(err)
	}

	if fmt.Sprintf("%#x", packed) != expected {
		t.Fatal("packed != expected")
	}
}
